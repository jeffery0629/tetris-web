# Leaderboard Setup Guide

## åŠŸèƒ½èªªæ˜
éŠæˆ²ç¾åœ¨æ”¯æ´**å…¨çƒæ’è¡Œæ¦œ**åŠŸèƒ½ï¼Œä½¿ç”¨ **Cloudflare Worker + GitHub Gist** ä½œç‚ºå®‰å…¨çš„é›²ç«¯å„²å­˜ã€‚æœ‹å‹å€‘å¯ä»¥çœ‹åˆ°å½¼æ­¤çš„åˆ†æ•¸ä¸¦äº’ç›¸ç«¶çˆ­ï¼

### æ¶æ§‹èªªæ˜
```
Web éŠæˆ² â†’ Cloudflare Worker (ä»£ç†) â†’ GitHub Gist (è³‡æ–™åº«)
              â†‘ Token å®‰å…¨å­˜æ”¾åœ¨æ­¤
```

**å„ªé»**ï¼š
- âœ… GitHub Token ä¸æœƒæš´éœ²çµ¦ç©å®¶
- âœ… å…§å»ºé˜²ä½œå¼Šæª¢æŸ¥ï¼ˆåˆ†æ•¸ä¸Šé™ï¼‰
- âœ… å…è²»ä¸”ç„¡éœ€ä¼ºæœå™¨ç¶­è­·
- âœ… å…¨çƒ CDN åŠ é€Ÿ

---

## è¨­å®šæ­¥é©Ÿ (10åˆ†é˜)

### Step 1: å»ºç«‹ GitHub Gist

1. ç™»å…¥ä½ çš„ GitHub å¸³è™Ÿ
2. å‰å¾€ https://gist.github.com/
3. é»æ“Šå³ä¸Šè§’ **"+"** â†’ **"New gist"**
4. è¨­å®šå¦‚ä¸‹ï¼š
   - **Filename**: `tetris_leaderboard.json`
   - **Content**:
     ```json
     {
       "casual": [],
       "classic": [],
       "crazy": []
     }
     ```
   - **Public/Secret**: é¸æ“‡ **Public** (é€™æ¨£æ‰€æœ‰äººéƒ½èƒ½è®€å–)
5. é»æ“Š **"Create public gist"**
6. **è¤‡è£½ Gist ID** (ç¶²å€æœ€å¾Œä¸€æ®µ)
   - ä¾‹å¦‚ï¼š`https://gist.github.com/jeffery0629/abc123def456`
   - Gist ID å°±æ˜¯ `abc123def456`

---

### Step 2: å»ºç«‹ GitHub Personal Access Token

1. å‰å¾€ GitHub Settings: https://github.com/settings/tokens
2. é»æ“Š **"Generate new token"** â†’ **"Generate new token (classic)"**
3. è¨­å®šï¼š
   - **Note**: `Tetris Leaderboard`
   - **Expiration**: `No expiration` (æˆ–é¸æ“‡ä½ æƒ³è¦çš„æœŸé™)
   - **Scopes**: åªå‹¾é¸ **`gist`** (å…è¨±è®€å¯« Gist)
4. é»æ“Š **"Generate token"**
5. **è¤‡è£½ Token** (åªæœƒé¡¯ç¤ºä¸€æ¬¡ï¼è«‹å¦¥å–„ä¿å­˜)
   - æ ¼å¼é¡ä¼¼ï¼š`ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

---

### Step 3: éƒ¨ç½² Cloudflare Worker

1. è¨»å†Š Cloudflare å¸³è™Ÿï¼šhttps://dash.cloudflare.com/sign-upï¼ˆå…è²»ï¼‰
2. å‰å¾€ **Workers & Pages** â†’ **Create application** â†’ **Create Worker**
3. å‘½åç‚º `tetris-leaderboard`ï¼Œé»æ“Š **Deploy**
4. é»æ“Š **Edit code**ï¼Œè²¼ä¸Š Worker ç¨‹å¼ç¢¼ï¼ˆè¦‹ä¸‹æ–¹ï¼‰
5. é»æ“Š **Save and Deploy**

**Worker ç¨‹å¼ç¢¼**ï¼š
```javascript
// è¦‹å°ˆæ¡ˆä¸­çš„ docs/cloudflare-worker.js
// æˆ–ç›´æ¥å¾ GitHub è¤‡è£½ï¼š
// https://github.com/jeffery0629/claire/blob/main/docs/cloudflare-worker.js
```

6. å‰å¾€ **Settings** â†’ **Variables and Secrets**
7. æ–°å¢å…©å€‹ **Secret** è®Šæ•¸ï¼š
   - `GIST_ID`: ä½ çš„ Gist ID
   - `GITHUB_TOKEN`: ä½ çš„ GitHub Token

8. è¨˜ä¸‹ Worker URLï¼ˆä¾‹å¦‚ï¼š`https://tetris-leaderboard.ä½ çš„å¸³è™Ÿ.workers.dev`ï¼‰

---

### Step 4: æ›´æ–°éŠæˆ²è¨­å®šï¼ˆWeb ç‰ˆè‡ªå‹•ä½¿ç”¨ï¼‰

**æ¡Œé¢ç‰ˆ (.exe)**ï¼š
å¦‚æœè¦åœ¨æœ¬åœ°æ¸¬è©¦ï¼Œå»ºç«‹ `.env` æª”æ¡ˆï¼š
```bash
# d:/Jeffery/claire/.env
WORKER_URL=https://tetris-leaderboard.ä½ çš„å¸³è™Ÿ.workers.dev
```

**Web ç‰ˆ**ï¼š
ç¨‹å¼ç¢¼å·²å…§å»º Worker URLï¼Œç„¡éœ€é¡å¤–è¨­å®šã€‚

---

### Step 5: å®‰è£ä¾è³´å¥—ä»¶

æ’è¡Œæ¦œåŠŸèƒ½éœ€è¦ `requests` å¥—ä»¶ï¼š

```bash
# ä½¿ç”¨ uv å®‰è£
uv pip install requests

# æˆ–ä½¿ç”¨ pip
pip install requests
```

---

### Step 6: æ¸¬è©¦æ’è¡Œæ¦œ

1. å•Ÿå‹•éŠæˆ²
2. å®Œæˆä¸€å±€éŠæˆ²
3. Game Over æ™‚æœƒè‡ªå‹•é¡¯ç¤ºæ’è¡Œæ¦œ
4. ç¢ºèªèƒ½çœ‹åˆ° "No scores yet!" æˆ–å·²æœ‰çš„åˆ†æ•¸

---

## ä½¿ç”¨èªªæ˜

### ç©å®¶æµç¨‹

1. **éŠæˆ²çµæŸ** â†’ Game Over ç•«é¢å½ˆå‡º
2. **è¼¸å…¥ Player ID** â†’ æœ€å¤š12å­—å…ƒçš„æš±ç¨±
3. **è‡ªå‹•ä¸Šå‚³** â†’ æˆç¸¾æäº¤åˆ°é›²ç«¯
4. **æŸ¥çœ‹æ’è¡Œ** â†’ è‡ªå‹•é¡¯ç¤ºè©²æ¨¡å¼ Top 10

### æ’è¡Œæ¦œç‰¹é»

- âœ… **å³æ™‚æ›´æ–°**ï¼šæœ‹å‹å€‘ç©å®Œç«‹åˆ»çœ‹åˆ°
- âœ… **åˆ†æ¨¡å¼æ’è¡Œ**ï¼šCasual / Classic / Crazy å„è‡ªç¨ç«‹
- âœ… **Top 10 é¡¯ç¤º**ï¼šé¡¯ç¤ºå‰10å
- âœ… **è‡ªå‹•æ’åº**ï¼šä¾åˆ†æ•¸é«˜åˆ°ä½
- âœ… **é«˜äº®é¡¯ç¤º**ï¼šä½ çš„æˆç¸¾æœƒç”¨æ©˜è‰²æ¨™è¨˜
- âœ… **é˜²æ­¢è†¨è„¹**ï¼šæ¯å€‹æ¨¡å¼æœ€å¤šä¿ç•™100ç­†ç´€éŒ„

---

## é›¢ç·šæ¨¡å¼

å¦‚æœæ²’æœ‰è¨­å®š `GIST_ID` å’Œ `GITHUB_TOKEN`ï¼š
- âœ… éŠæˆ²å¯ä»¥æ­£å¸¸éŠç©
- âŒ æ’è¡Œæ¦œåŠŸèƒ½æœƒåœç”¨
- â„¹ï¸ ä¸æœƒé¡¯ç¤ºéŒ¯èª¤ï¼Œåªæ˜¯ç„¡æ³•ä¸Šå‚³/æŸ¥çœ‹åˆ†æ•¸

---

## å®‰å…¨æ€§èªªæ˜

### âœ… æ–°æ¶æ§‹çš„å®‰å…¨æ€§
- **Token æ°¸ä¸æš´éœ²**ï¼šå­˜æ”¾åœ¨ Cloudflare Worker ç’°å¢ƒè®Šæ•¸ä¸­ï¼ˆåŠ å¯†ï¼‰
- **é˜²ä½œå¼Šæ©Ÿåˆ¶**ï¼šWorker æœƒæª¢æŸ¥åˆ†æ•¸ä¸Šé™
  - Casual: 50,000 åˆ†
  - Classic: 100,000 åˆ†
  - Crazy: 200,000 åˆ†
- **CORS ä¿è­·**ï¼šåªå…è¨±ç‰¹å®šç¶²åŸŸå­˜å–
- **API é™æµ**ï¼šCloudflare è‡ªå‹•é˜²è­· DDoS

### GitHub Token æ¬Šé™
- âœ… Token åªæœ‰ `gist` æ¬Šé™ï¼ˆç„¡æ³•å­˜å–ä½ çš„å…¶ä»–è³‡æ–™ï¼‰
- âœ… å¯éš¨æ™‚åœ¨ GitHub Settings æ’¤éŠ·ä¸¦é‡æ–°ç”Ÿæˆ

### Gist å…¬é–‹æ€§
- â„¹ï¸ Gist æ˜¯å…¬é–‹çš„ï¼Œä»»ä½•äººéƒ½èƒ½**è®€å–**
- âœ… ä½†åªæœ‰é€é Worker æ‰èƒ½**å¯«å…¥**ï¼ˆéœ€é€šéé©—è­‰ï¼‰
- â„¹ï¸ å¦‚æœç™¼ç¾ä½œå¼Šï¼Œå¯ä»¥åœ¨ Gist é é¢æ‰‹å‹•åˆªé™¤è©²ç­†ç´€éŒ„

---

## å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼ä¸Šå‚³å¤±æ•—ï¼Ÿ
A: æª¢æŸ¥ï¼š
1. `.env` æª”æ¡ˆæ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¢º
2. `GIST_ID` å’Œ `GITHUB_TOKEN` æ˜¯å¦æ­£ç¢º
3. ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸
4. GitHub Token æ˜¯å¦éæœŸæˆ–è¢«æ’¤éŠ·

### Q: å¯ä»¥çœ‹åˆ°æ’è¡Œæ¦œä½†ç„¡æ³•ä¸Šå‚³ï¼Ÿ
A: Token å¯èƒ½åªæœ‰è®€å–æ¬Šé™ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆä¸¦å‹¾é¸ `gist` scope

### Q: å¤šå€‹ç©å®¶åŒæ™‚ä¸Šå‚³æœƒè¡çªå—ï¼Ÿ
A: ç¨‹å¼å·²å¯¦ä½œé‡è©¦æ©Ÿåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰ï¼Œ20äººä»¥ä¸‹ä½¿ç”¨ä¸æœƒæœ‰å•é¡Œ

### Q: å¦‚ä½•æ‰‹å‹•ç®¡ç†æ’è¡Œæ¦œï¼Ÿ
A: å‰å¾€ä½ çš„ Gist é é¢ï¼š
- æŸ¥çœ‹æ‰€æœ‰åˆ†æ•¸
- æ‰‹å‹•ç·¨è¼¯ JSON
- æŸ¥çœ‹ä¿®æ”¹æ­·å² (å³ä¸Šè§’ "Revisions")
- åˆªé™¤ä½œå¼Šæˆç¸¾

### Q: å¦‚ä½•é—œé–‰æ’è¡Œæ¦œåŠŸèƒ½ï¼Ÿ
A: åˆªé™¤ `.env` æª”æ¡ˆæˆ–ç§»é™¤ `GIST_ID` / `GITHUB_TOKEN` ç’°å¢ƒè®Šæ•¸

---

## é€²éšï¼šæœ¬åœ°æ¸¬è©¦

å¦‚æœæƒ³åœ¨ä¸å½±éŸ¿æ­£å¼æ’è¡Œæ¦œçš„æƒ…æ³ä¸‹æ¸¬è©¦ï¼š

1. å»ºç«‹ç¬¬äºŒå€‹ Gist (æ¸¬è©¦ç”¨)
2. åœ¨ `.env` ä½¿ç”¨æ¸¬è©¦ Gist ID
3. æ¸¬è©¦å®Œç•¢å¾Œæ”¹å›æ­£å¼ Gist ID

---

## æŠ€è¡“ç´°ç¯€

- **å„²å­˜æ ¼å¼**ï¼šJSON (ç´”æ–‡å­—)
- **è³‡æ–™å¤§å°**ï¼šæ¯ç­†ç´„ 100 bytesï¼Œ100 ç­† = 10KB
- **API é™åˆ¶**ï¼š5000 æ¬¡/å°æ™‚ (ä½¿ç”¨ Token)
- **å¿«å–æ©Ÿåˆ¶**ï¼š30 ç§’æœ¬åœ°å¿«å–æ¸›å°‘ API å‘¼å«
- **é‡è©¦æ©Ÿåˆ¶**ï¼šæœ€å¤š 3 æ¬¡ï¼ŒæŒ‡æ•¸é€€é¿ (0.5s â†’ 1.0s â†’ 1.5s)
- **ä½µç™¼è™•ç†**ï¼šæ¨‚è§€é– (Optimistic Locking)

---

## æ”¯æ´

å¦‚æœ‰å•é¡Œè«‹åœ¨ GitHub Issues å›å ±ï¼š
https://github.com/jeffery0629/tetris-web/issues

ç¥éŠæˆ²æ„‰å¿«ï¼ğŸ’–
